{"version":3,"sources":["constants.ts","utils/convert.ts","resources/water.png","components/Element.tsx","resources/fire.png","components/GameScreen.tsx","slices/saveSlice.tsx","utils/merge.ts","store.tsx","styles/GlobalStyle.tsx","styles/theme.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["mergeTransitionDuration","convertUnit","value","from","to","window","innerWidth","innerHeight","ElementWrapper","styled","div","theme","color","eleBg","elementId","eleShadow","mergingData","mergedData","targetPos","y","x","isHovering","ElementName","Element","React","forwardRef","props","ref","useState","pos","setPos","prevZIndex","setPrevZIndex","targetRef","useRef","handleMouseMove","useCallback","ev","state","Math","min","max","movementX","screenRef","current","offsetWidth","movementY","offsetHeight","useEffect","isDragging","addEventListener","removeEventListener","zIndex","style","left","top","node","onMouseDown","data-id","id","MainScreen","bg","GameScreen","Array","length","nanoid","elements","setElements","undefined","draggingElement","setDragging","hoveringElement","setHovering","mergingElements","setMerging","mergedElements","setMerged","maxZIndex","setMaxZIndex","mousedownHandler","find","v","elementRefs","testOverlap","rect1","getBoundingClientRect","sortedRefs","Object","entries","sort","a","b","i","rect2","bottom","right","keys","key","mouseleaveHandler","mouseupHandler","target","HTMLElement","dataset","overlapId","ele1id","ele2id","toCreate","mergingRect","mergedRect","mergingPos","mergedPos","setTimeout","map","filter","_","merge","mousemoveHandler","overlapIndex","elementIds","fromEntries","includes","ele","el","initialState","unlockedElements","saveSlice","createSlice","name","reducers","unlockElement","action","payload","push","actions","mergeObject","source","isArray","mergeArray","constructor","l","persistedState","JSON","parse","localStorage","getItem","store","configureStore","reducer","save","saveReducer","preloadedState","saveInitialState","subscribe","throttle","setItem","stringify","getState","GlobalStyle","createGlobalStyle","App","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.921d1e4f.chunk.js","sourcesContent":["export const mergeTransitionDuration = 0.7;\n","type Unit = \"px\" | \"vw\" | \"vh\";\n\nexport function convertUnit(value: number, from: Unit, to: Unit) {\n  if (from === to) return value;\n\n  switch (from) {\n    case \"vw\":\n      value *= window.innerWidth / 100;\n      break;\n    case \"vh\":\n      value *= window.innerHeight / 100;\n      break;\n  }\n  switch (to) {\n    case \"vw\":\n      return (value *= 100 / window.innerWidth);\n    case \"vh\":\n      return (value *= 100 / window.innerHeight);\n    case \"px\":\n      return value;\n  }\n}\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAJBJREFUOE+lk8ERgCAMBKEHy/FBCZZqCTwsxx5wMhoJIUeYgS/s5iAkBmelq5S8x4iOwQ0GlgQEswilgAkkPJIMBWkLId/19lYKU8DVtYBUWgIFFjwlsO6uWyhTdAmWBFMwP+rxfq4mgSeQHQmWgIxIYsFdAiRoYDr0VTcFUtKBCoaCv21nnQVZVbbVnUZv3B+lKUYR3c3j4wAAAABJRU5ErkJggg==\"","import React, { useCallback, useRef, useState } from \"react\";\nimport { useEffect } from \"react\";\nimport styled from \"styled-components\";\nimport { mergeTransitionDuration } from \"../constants\";\nimport waterImg from \"../resources/water.png\";\nimport fireImg from \"../resources/fire.png\";\nimport { convertUnit } from \"../utils/convert\";\nimport { IMergedElement, IMergingElement } from \"./GameScreen\";\n\nconst ElementWrapper = styled.div<{\n  isHovering: boolean;\n  mergingData: IMergingElement | undefined;\n  mergedData: IMergedElement | undefined;\n  elementId: number;\n}>`\n  --elementSize: 10vmin;\n  position: absolute;\n  width: var(--elementSize);\n  height: var(--elementSize);\n  background-color: ${({ theme }) => theme.color.eleBg};\n  border-radius: 1vmin;\n  padding: 0;\n\n  background-image: url(\"${({ elementId }) =>\n    elementId === 0 ? waterImg : fireImg}\");\n\n  background-repeat: no-repeat;\n  background-size: var(--elementSize);\n  image-rendering: pixelated;\n  image-rendering: crisp-edges;\n\n  box-shadow: 0 0 10px ${({ theme }) => theme.color.eleShadow};\n\n  transition: transform 0.3s cubic-bezier(0.23, 1, 0.32, 1),\n    box-shadow 0.3s cubic-bezier(0.23, 1, 0.32, 1), background-image 0.2s linear;\n\n  :hover {\n    transform: scale(1.1);\n    cursor: pointer;\n    box-shadow: 0 0 15px ${({ theme }) => theme.color.eleShadow};\n  }\n\n  :active {\n    transform: scale(1.2);\n    box-shadow: 0 0 20px ${({ theme }) => theme.color.eleShadow};\n  }\n\n  ${({ mergingData }) => {\n    return mergingData\n      ? `transform: scale(1.3) !important; \n  transition: transform ${mergeTransitionDuration}s\n    cubic-bezier(0.075, 0.82, 0.165, 1);`\n      : null;\n  }}\n  ${({ mergedData }) => {\n    return mergedData\n      ? `transform: scale(0.3) !important; \n  top: ${mergedData.targetPos.y}vh !important;\n  left: ${mergedData.targetPos.x}vw !important;\n  transition: transform ${mergeTransitionDuration}s\n  cubic-bezier(.72,-1.24,.33,-0.04), \n    top ${mergeTransitionDuration}s cubic-bezier(.32,-3.29,.85,.59),\n    left ${mergeTransitionDuration}s cubic-bezier(.32,-3.29,.85,.59);`\n      : null;\n  }}\n  ${({ isHovering, theme }) => {\n    return isHovering\n      ? `transform: scale(1.1); \n      box-shadow: 0 0 15px ${theme.color.eleShadow};`\n      : null;\n  }};\n`;\n\nconst ElementName = styled.div`\n  position: absolute;\n  color: white;\n  bottom: -1.2em;\n\n  font-family: \"Azeret Mono\", monospace;\n  font-weight: 700;\n  font-size: 1.2em;\n  width: 100%;\n  text-align: center;\n`;\n\ninterface ElementProps {\n  elementId: number;\n  isDragging: boolean;\n  isHovering: boolean;\n  mergedData: IMergedElement | undefined;\n  mergingData: IMergingElement | undefined;\n  onMouseDown: React.MouseEventHandler<HTMLDivElement> | undefined;\n  screenRef: React.MutableRefObject<HTMLDivElement>;\n  zIndex?: number;\n  id: string;\n}\n\nexport const Element = React.forwardRef<HTMLDivElement, ElementProps>(\n  (props, ref) => {\n    const [pos, setPos] = useState({ x: 0, y: 0 });\n    const [prevZIndex, setPrevZIndex] = useState(0);\n    const targetRef =\n      useRef<HTMLDivElement | null>() as React.MutableRefObject<HTMLDivElement | null>;\n\n    const handleMouseMove = useCallback(\n      (ev: MouseEvent) => {\n        if (props.mergingData || props.mergedData) return;\n        setPos((state) => ({\n          x: convertUnit(\n            Math.min(\n              Math.max(convertUnit(state.x, \"vw\", \"px\") + ev.movementX, 0),\n              props.screenRef.current.offsetWidth -\n                (targetRef?.current?.offsetWidth ?? 0)\n            ),\n            \"px\",\n            \"vw\"\n          ),\n          y: convertUnit(\n            Math.min(\n              Math.max(convertUnit(state.y, \"vh\", \"px\") + ev.movementY, 0),\n              props.screenRef.current.offsetHeight -\n                (targetRef?.current?.offsetHeight ?? 0)\n            ),\n            \"px\",\n            \"vh\"\n          ),\n        }));\n      },\n      [props.mergingData, props.mergedData, props.screenRef]\n    );\n\n    useEffect(() => {\n      if (props.isDragging) {\n        window.addEventListener(\"mousemove\", handleMouseMove);\n      } else {\n        window.removeEventListener(\"mousemove\", handleMouseMove);\n      }\n    }, [props.isDragging, handleMouseMove]);\n\n    useEffect(() => {\n      if (!props.zIndex) return;\n      setPrevZIndex(props.zIndex);\n    }, [props.zIndex]);\n\n    return (\n      <ElementWrapper\n        elementId={props.elementId}\n        style={{\n          left: pos.x + \"vw\",\n          top: pos.y + \"vh\",\n          zIndex: props.zIndex ?? prevZIndex,\n        }}\n        ref={(node) => {\n          targetRef.current = node;\n          if (typeof ref === \"function\") {\n            ref(node);\n          } else if (ref) {\n            (ref as React.MutableRefObject<HTMLDivElement | null>).current =\n              node;\n          }\n        }}\n        isHovering={props.isHovering}\n        mergingData={props.mergingData}\n        mergedData={props.mergedData}\n        onMouseDown={props.onMouseDown}\n        data-id={props.id}>\n        <ElementName data-id={props.id}>\n          {props.elementId === 0 ? \"WATER DROP\" : \"FIRE\"}\n        </ElementName>\n      </ElementWrapper>\n    );\n  }\n);\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAKVJREFUOE+lkzEOwyAMRUPUMXsukLk9UU+XE7VzLpA9Y0SrPxgZ428UhQWE/Z+/QU5DZ22v8bd8cmJpNAABxNhvAyIIdSDVxTpz4QKsOII0ACZmbVQAK56e43B8c/UBtpUuAOoIUgBedV1aQ7QLFwDrdjEXDcATC8xzcQmg30PaaB5RHMzvR+liX89yFhcUgExANAB3AgkBMkAMYMXID6exN+qI/wFjvWARv6aB+AAAAABJRU5ErkJggg==\"","import { nanoid } from \"@reduxjs/toolkit\";\nimport React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport styled from \"styled-components\";\nimport { mergeTransitionDuration } from \"../constants\";\nimport { convertUnit } from \"../utils/convert\";\nimport { Element } from \"./Element\";\n\nconst MainScreen = styled.div`\n  width: 100vw;\n  height: 100vh;\n  background-color: ${({ theme }) => theme.color.bg};\n`;\n\ninterface IElement {\n  elementId: number;\n  id: string;\n}\n\nexport interface IMergingElement {\n  id: string;\n  targetPos: { x: number; y: number };\n}\n\nexport interface IMergedElement {\n  id: string;\n  targetPos: { x: number; y: number };\n}\n\nconst createNewElement = (elementId: number): IElement => ({\n  elementId,\n  id: nanoid(),\n});\n\nexport const GameScreen = () => {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const [elements, setElements] = useState<IElement[]>(\n    Array.from({ length: 20 }, () => createNewElement(0))\n  );\n  const [draggingElement, setDragging] = useState<string | undefined>(\n    undefined\n  );\n  const [hoveringElement, setHovering] = useState<string | undefined>(\n    undefined\n  );\n  const [mergingElements, setMerging] = useState<IMergingElement[]>([]);\n  const [mergedElements, setMerged] = useState<IMergedElement[]>([]);\n  const [maxZIndex, setMaxZIndex] = useState(0);\n  const targetRef =\n    useRef<HTMLDivElement>() as React.MutableRefObject<HTMLDivElement>;\n  const mousedownHandler = useCallback(\n    (id: string) => () => {\n      if (\n        mergingElements.find((v) => v.id === id) ||\n        mergedElements.find((v) => v.id === id)\n      )\n        return;\n      setMaxZIndex((state) => state + 1);\n      setDragging(id);\n    },\n    [mergedElements, mergingElements]\n  );\n  const elementRefs = useRef<{ [id: string]: HTMLDivElement | null }>({});\n\n  const testOverlap = (id: string): string | undefined => {\n    const rect1 = elementRefs.current[id]?.getBoundingClientRect();\n    if (!rect1) return;\n    const sortedRefs = [...Object.entries(elementRefs.current)].sort((a, b) =>\n      a[1]?.style?.zIndex\n        ? b[1]?.style?.zIndex\n          ? +b[1].style.zIndex - +a[1].style.zIndex\n          : -1\n        : 1\n    );\n\n    for (let i = 1; i < sortedRefs.length; i++) {\n      const v = sortedRefs[i][1];\n      if (!v) continue;\n      const rect2 = v.getBoundingClientRect();\n      if (\n        rect1.top <= rect2.bottom &&\n        rect1.bottom >= rect2.top &&\n        rect1.left <= rect2.right &&\n        rect1.right >= rect2.left\n      )\n        return Object.keys(elementRefs.current).find(\n          (key) => elementRefs.current[key] === v\n        );\n    }\n  };\n\n  useEffect(() => {\n    const merge = (ele1id: string, ele2id: string, toCreate: number) => {\n      const mergingRect = elementRefs.current[ele1id]?.getBoundingClientRect();\n      const mergedRect = elementRefs.current[ele2id]?.getBoundingClientRect();\n      if (!mergingRect || !mergedRect) return;\n      const mergingPos = {\n        x: convertUnit(mergingRect.x, \"px\", \"vw\"),\n        y: convertUnit(mergingRect.y, \"px\", \"vh\"),\n      };\n      const mergedPos = {\n        x: convertUnit(mergedRect.x, \"px\", \"vw\"),\n        y: convertUnit(mergedRect.y, \"px\", \"vh\"),\n      };\n\n      setMerging((state) => [...state, { id: ele1id, targetPos: mergedPos }]);\n      setMerged((state) => [...state, { id: ele2id, targetPos: mergingPos }]);\n\n      setTimeout(() => {\n        setElements((elements) =>\n          elements.map((v, i) =>\n            v.id === ele1id ? { ...v, elementId: toCreate } : v\n          )\n        );\n        setMerging((state) => state.filter((v, _) => v.id !== ele1id));\n        setMerged((state) => state.filter((v, _) => v.id !== ele2id));\n        setElements((elements) => elements.filter((v, _) => v.id !== ele2id));\n      }, mergeTransitionDuration * 1000);\n    };\n\n    const mouseleaveHandler = () => setDragging(undefined);\n    const mouseupHandler = (ev: MouseEvent) => {\n      setDragging(undefined);\n      setHovering(undefined);\n      if (ev.target instanceof HTMLElement && ev.target.dataset.id) {\n        const id = ev.target.dataset.id;\n        if (!id) return;\n        const overlapId = testOverlap(id);\n        if (typeof overlapId === \"undefined\") return;\n        else merge(id, overlapId, 1);\n      }\n    };\n\n    const { current } = targetRef;\n    current.addEventListener(\"mouseup\", mouseupHandler);\n    current.addEventListener(\"mouseleave\", mouseleaveHandler);\n    return () => {\n      current.removeEventListener(\"mouseup\", mouseupHandler);\n      current.removeEventListener(\"mouseleave\", mouseleaveHandler);\n    };\n  }, []);\n\n  useEffect(() => {\n    const mousemoveHandler = () => {\n      if (typeof draggingElement === \"undefined\") return;\n      const overlapIndex = testOverlap(draggingElement);\n      setHovering(overlapIndex);\n    };\n\n    const { current } = targetRef;\n    current.addEventListener(\"mousemove\", mousemoveHandler);\n    return () => {\n      current.removeEventListener(\"mousemove\", mousemoveHandler);\n    };\n  }, [draggingElement]);\n\n  useEffect(() => {\n    const elementIds = elements.map((v) => v.id);\n    elementRefs.current = Object.fromEntries(\n      Object.entries(elementRefs.current).filter((v) =>\n        elementIds.includes(v[0])\n      )\n    );\n  }, [elements]);\n\n  return (\n    <MainScreen ref={targetRef}>\n      {elements.map((v, i) => (\n        <Element\n          key={v.id}\n          id={v.id}\n          elementId={v.elementId}\n          isDragging={draggingElement === v.id}\n          isHovering={hoveringElement === v.id}\n          mergingData={mergingElements.find((ele) => v.id === ele.id)}\n          mergedData={mergedElements.find((ele) => v.id === ele.id)}\n          onMouseDown={mousedownHandler(v.id)}\n          screenRef={targetRef}\n          ref={(el) => {\n            elementRefs.current[v.id] = el;\n          }}\n          zIndex={draggingElement === v.id ? maxZIndex + 1 : undefined}\n        />\n      ))}\n    </MainScreen>\n  );\n};\n","import { createSlice, PayloadAction } from \"@reduxjs/toolkit\";\n\nexport interface ISaveState {\n  unlockedElements: number[];\n}\n\nexport const initialState = {\n  unlockedElements: [1, 2, 3, 4],\n} as ISaveState;\n\nconst saveSlice = createSlice({\n  name: \"save\",\n  initialState,\n  reducers: {\n    unlockElement(state, action: PayloadAction<number>) {\n      if (!state.unlockedElements.includes(action.payload))\n        state.unlockedElements.push(action.payload);\n    },\n  },\n});\n\nexport const { unlockElement } = saveSlice.actions;\n\nexport default saveSlice.reducer;\n","// From https://github.com/spotky1004/Bunch-of-Achievements/blob/main/src/util/SaveLoad.js\n\nexport function mergeObject(target: any, source: any) {\n  target = target ?? {};\n  for (const i in source) {\n    if (Array.isArray(source[i])) {\n      target[i] = target[i] ?? [];\n      mergeArray(target[i], source[i]);\n    } else if (typeof source[i] === \"object\") {\n      target[i] = mergeObject(target[i], source[i]);\n    } else {\n      target[i] = source[i].constructor(target[i] ?? source[i]);\n    }\n  }\n  return target;\n}\nexport function deepCopy<T>(obj: T): T {\n  return mergeObject({}, obj);\n}\n\nexport function mergeArray(target: Array<any>, source: Array<any>) {\n  for (let i = 0, l = source.length; i < l; i++) {\n    if (Array.isArray(source[i])) {\n      mergeArray(target[i], source[i]);\n    } else if (typeof source[i] === \"object\") {\n      target[i] = mergeObject(target[i], source[i]);\n    } else {\n      target[i] = source[i].constructor(target[i] ?? source[i]);\n    }\n  }\n  return target;\n}\n","import { configureStore } from \"@reduxjs/toolkit\";\nimport saveReducer, {\n  initialState as saveInitialState,\n} from \"./slices/saveSlice\";\nimport { mergeObject } from \"./utils/merge\";\nimport _ from \"lodash\";\n\nconst persistedState = JSON.parse(\n  localStorage.getItem(\"notAMergeGame\") || \"{}\"\n);\n\nconst store = configureStore({\n  reducer: {\n    save: saveReducer,\n  },\n  preloadedState: mergeObject(persistedState, { save: saveInitialState }),\n});\n\nstore.subscribe(() => {\n  _.throttle(\n    () =>\n      localStorage.setItem(\"notAMergeGame\", JSON.stringify(store.getState())),\n    1000\n  );\n});\n\nexport type RootState = ReturnType<typeof store.getState>;\nexport type AppDispatch = typeof store.dispatch;\n\nexport default store;\n","import { createGlobalStyle } from \"styled-components\";\n\nexport const GlobalStyle = createGlobalStyle`\n  body {\n    overflow: hidden;\n  }\n  * {\n    margin: 0;\n    user-select: none;\n  }\n`;\n","export const theme = {\n  color: {\n    bg: \"#333\",\n    eleBg: \"#555\",\n    eleShadow: \"#000\",\n  },\n};\n","import React from \"react\";\nimport { Provider } from \"react-redux\";\nimport { ThemeProvider } from \"styled-components\";\nimport { GameScreen } from \"./components/GameScreen\";\nimport store from \"./store\";\nimport { GlobalStyle } from \"./styles/GlobalStyle\";\nimport { theme } from \"./styles/theme\";\nimport \"./font/font.css\";\n\nfunction App() {\n  return (\n    <>\n      <GlobalStyle />\n      <Provider store={store}>\n        <ThemeProvider theme={theme}>\n          <GameScreen />\n        </ThemeProvider>\n      </Provider>\n    </>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from \"web-vitals\";\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import(\"web-vitals\").then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}